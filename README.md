# Загородный клуб "Дача" - Приложение для технической службы

Веб-приложение для управления заявками технической службы с бэкендом на Kotlin/Ktor и фронтендом (в разработке).

## Возможности

- ✅ Авторизация с JWT токенами
- ✅ Три роли пользователей: Администратор, Руководитель, Техник
- ✅ Управление пользователями (только для администратора)
- ✅ Создание и управление заявками
- ✅ Принятие заявок техниками
- ✅ Завершение заявок
- ✅ Экспорт истории заявок в PDF
- ✅ WebSocket для обновлений в реальном времени

## Структура проекта

```
Загородный клуб "Дача"/
├── server/          # Ktor бэкенд сервер
└── app/             # Android приложение (в разработке)
```

## Запуск сервера

### Требования

- Java 17 или выше
- Gradle 8.13+

### Первый запуск

1. Убедитесь, что порт 8081 свободен (или измените в `server/src/main/resources/application.conf`)

2. Запустите сервер:
```bash
./gradlew :server:run
```

Сервер запустится на `http://localhost:8081`

### Учетные данные по умолчанию

При первом запуске создаётся администратор:
- **Email**: `admin@techapp.local`
- **Пароль**: `admin123`

⚠️ **Важно**: Измените пароль администратора в продакшене!

## API Endpoints

### Авторизация

- `POST /api/v1/auth/login` - Вход в систему
  ```json
  {
    "email": "admin@techapp.local",
    "password": "admin123"
  }
  ```
  Ответ:
  ```json
  {
    "accessToken": "...",
    "refreshToken": "...",
    "user": {
      "id": "...",
      "name": "Администратор",
      "role": "ADMIN"
    }
  }
  ```

### Пользователи (требуется роль ADMIN)

- `GET /api/v1/users` - Список всех пользователей
- `POST /api/v1/users` - Создать пользователя
  ```json
  {
    "email": "user@example.com",
    "password": "password123",
    "name": "Имя пользователя",
    "role": "TECHNICIAN"
  }
  ```
- `DELETE /api/v1/users/{id}` - Удалить пользователя

### Заявки

- `GET /api/v1/tickets` - Список заявок (фильтруется по роли)
- `POST /api/v1/tickets` - Создать заявку (требуется роль MANAGER или ADMIN)
  ```json
  {
    "title": "Заголовок заявки",
    "description": "Описание проблемы",
    "priority": "HIGH",
    "assigneeId": "uuid-техника",
    "deadlineAt": 1234567890
  }
  ```
- `PUT /api/v1/tickets/{id}/accept` - Принять заявку (для техника)
- `PUT /api/v1/tickets/{id}/complete` - Завершить заявку
- `GET /api/v1/tickets/export/pdf` - Экспорт заявок в PDF (требуется роль MANAGER или ADMIN)

### WebSocket

- `WS /ws?token={accessToken}` - Подключение для получения обновлений в реальном времени

## Роли и права доступа

### ADMIN (Администратор)
- Управление пользователями (создание, удаление)
- Просмотр всех заявок
- Создание заявок
- Экспорт PDF

### MANAGER (Руководитель)
- Просмотр всех заявок
- Создание заявок
- Назначение заявок техникам
- Экспорт PDF

### TECHNICIAN (Техник)
- Просмотр назначенных заявок
- Принятие заявок
- Завершение заявок

## Использование API

Все защищённые endpoints требуют заголовок:
```
Authorization: Bearer {accessToken}
```

## База данных

Используется SQLite. База данных создаётся автоматически в `data/techapp.db` при первом запуске.

## Разработка

### Сборка

```bash
./gradlew :server:build
```

### Запуск тестов

```bash
./gradlew :server:test
```

## Следующие шаги

- [ ] Фронтенд приложение (React/Next.js)
- [ ] PWA для Android
- [ ] Уведомления в реальном времени через WebSocket
- [ ] Загрузка файлов к заявкам
- [ ] Комментарии к заявкам
- [ ] История изменений заявок

## Лицензия

MIT



