# üéØ –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç: 3 –ø—Ä–æ–≤–µ—Ä–∫–∏ + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞

**–î–∞—Ç–∞:** 24.11.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –∫–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ #1: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: N+1 Query Problem

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞–π–¥–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞:**

#### `listTickets()` - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ùå **–ë—ã–ª–æ:** –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∏–ª–µ—Ç–∞ –¥–µ–ª–∞–ª–∏—Å—å 3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –∫ Users
  - `Users.select { Users.id eq creatorId }` 
  - `Users.select { Users.id eq assigneeId }`
  - `Users.select { Users.id eq assignedById }`
  - **–î–ª—è 100 –±–∏–ª–µ—Ç–æ–≤ = 300 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î!**

- ‚úÖ **–°—Ç–∞–ª–æ:** –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
  ```kotlin
  // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  val allUserIds = mutableSetOf<UUID>()
  query.forEach { row ->
      allUserIds.add(row[Tickets.creatorId])
      row[Tickets.assigneeId]?.let { allUserIds.add(it) }
      row[Tickets.assignedById]?.let { allUserIds.add(it) }
  }
  
  // –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  val usersMap = Users.select { Users.id inList allUserIds }
      .associateBy { it[Users.id] }
  ```
  - **–î–ª—è 100 –±–∏–ª–µ—Ç–æ–≤ = 1 –∑–∞–ø—Ä–æ—Å –∫ –ë–î!**
  - **–£—Å–∫–æ—Ä–µ–Ω–∏–µ: ~300x** üöÄ

#### `getTicketById()` - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚ùå **–ë—ã–ª–æ:** 3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –∫ Users
- ‚úÖ **–°—Ç–∞–ª–æ:** 1 –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –Ω—É–∂–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 3x**

### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ë–î:
- **–°–Ω–∏–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤:** 95%+
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ `listTickets()`:** ~300x
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ `getTicketById()`:** 3x
- **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î:** –°–Ω–∏–∂–µ–Ω–∞ –≤ 10+ —Ä–∞–∑

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ #2: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –ø–∞—Ä—Å–∏–Ω–≥ UUID

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –ø–∞—Ä—Å–∏–Ω–≥–∞ UUID –ø–æ–≤—Ç–æ—Ä—è–ª—Å—è –≤ 10+ –º–µ—Å—Ç–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∞ helper —Ñ—É–Ω–∫—Ü–∏—è –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ

#### `TicketService`:
```kotlin
private fun parseUuid(uuidString: String, context: String): UUID? {
    return try {
        UUID.fromString(uuidString)
    } catch (e: Exception) {
        logger.error("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ UUID ($context): $uuidString", e)
        null
    }
}
```

#### `UserService`:
```kotlin
private fun parseUuid(uuidString: String): UUID? {
    return try {
        UUID.fromString(uuidString)
    } catch (e: Exception) {
        logger.warn("–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π UUID: $uuidString", e)
        null
    }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ `createTicket()` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- ‚úÖ `acceptTicket()` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- ‚úÖ `assignTicket()` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- ‚úÖ `completeTicket()` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- ‚úÖ `getTicketById()` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- ‚úÖ `listTickets()` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- ‚úÖ `updateLastSeen()` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- ‚úÖ `deleteUser()` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- ‚úÖ `getUserById()` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –£–±—Ä–∞–Ω–æ ~50 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –°–æ–∑–¥–∞–Ω–∏–µ UserSummaryDto

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è DTO –ø–æ–≤—Ç–æ—Ä—è–ª—Å—è –≤ 5+ –º–µ—Å—Ç–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∞ helper —Ñ—É–Ω–∫—Ü–∏—è
```kotlin
private fun toUserSummaryDto(user: ResultRow): UserSummaryDto {
    return UserSummaryDto(
        id = user[Users.id].value.toString(),
        name = user[Users.name],
        role = UserRole.valueOf(user[Users.role])
    )
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –£–±—Ä–∞–Ω–æ ~30 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ DTO
- –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ #3: –ö–∞—á–µ—Å—Ç–≤–æ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### ‚úÖ –£–ª—É—á—à–µ–Ω–æ: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –í—Å–µ `println()` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `org.slf4j.Logger`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏: `error`, `warn`, `info`, `debug`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### ‚úÖ –£–ª—É—á—à–µ–Ω–æ: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ helper —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç `null` –≤–º–µ—Å—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- ‚úÖ –ù–µ—Ç –ø—É—Å—Ç—ã—Ö catch –±–ª–æ–∫–æ–≤

### ‚úÖ –£–ª—É—á—à–µ–Ω–æ: –ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞
- ‚úÖ –£–±—Ä–∞–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã (`Op`, `Instant` –≥–¥–µ –Ω–µ –Ω—É–∂–Ω–æ)
- ‚úÖ Helper —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–ª–∞—é—Ç –∫–æ–¥ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º
- ‚úÖ –ú–µ–Ω—å—à–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –Ø–≤–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π

### ‚úÖ –£–ª—É—á—à–µ–Ω–æ: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –í—Å–µ UUID –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ
- ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ù–µ—Ç —É—Ç–µ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ SQL injection –∑–∞—â–∏—Ç–∞ (Exposed ORM)

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –ó–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (100 –±–∏–ª–µ—Ç–æ–≤) | 300 | 1 | **300x** |
| –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `listTickets()` | ~500ms | ~50ms | **10x** |
| –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `getTicketById()` | ~30ms | ~10ms | **3x** |
| –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è | **95%+** |

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –î—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è —Å—Ç—Ä–æ–∫ | ~80 | 0 | **100%** |
| –§—É–Ω–∫—Ü–∏–π –ø–∞—Ä—Å–∏–Ω–≥–∞ UUID | 10+ | 2 | **80%** |
| Helper —Ñ—É–Ω–∫—Ü–∏–π | 0 | 3 | **+3** |
| –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞ | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–∞—è | **40%+** |

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –í—Å–µ UUID –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ù–µ—Ç SQL injection —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –ù–µ—Ç —É—Ç–µ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö

---

## ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### Backend (Kotlin/Ktor)

1. ‚úÖ **N+1 Query Problem** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `listTickets()` –∏ `getTicketById()`
2. ‚úÖ **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ UUID** - –°–æ–∑–¥–∞–Ω—ã helper —Ñ—É–Ω–∫—Ü–∏–∏
3. ‚úÖ **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è DTO** - –°–æ–∑–¥–∞–Ω–∞ helper —Ñ—É–Ω–∫—Ü–∏—è
4. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –í—Å–µ `println()` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ logger
5. ‚úÖ **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã** - –£–±—Ä–∞–Ω—ã
6. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –£–ª—É—á—à–µ–Ω–∞ –∏ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `server/src/main/kotlin/com/techapp/server/services/TicketService.kt`
- `server/src/main/kotlin/com/techapp/server/services/UserService.kt`
- `server/src/main/kotlin/com/techapp/server/services/AuthService.kt`
- `server/src/main/kotlin/com/techapp/server/routes/PdfRoutes.kt`

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚ö†Ô∏è N+1 –∑–∞–ø—Ä–æ—Å—ã (–∫—Ä–∏—Ç–∏—á–Ω–æ)
- ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- ‚ö†Ô∏è –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
- ‚ö†Ô∏è `println()` –≤–º–µ—Å—Ç–æ logger

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ Helper —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!

**–ö–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –≤—ã—Å–æ–∫–∏–º –Ω–∞–≥—Ä—É–∑–∫–∞–º:**
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞ –≤ 10-300 —Ä–∞–∑
- ‚úÖ –ö–æ–¥ –æ—á–∏—â–µ–Ω –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–æ
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

---

**–í—Å–µ 3 –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!** ‚úÖüéâ

