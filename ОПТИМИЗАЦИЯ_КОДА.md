# üöÄ –û—Ç—á—ë—Ç –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ (3 –ø—Ä–æ–≤–µ—Ä–∫–∏)

**–î–∞—Ç–∞:** 24.11.2025  
**–ü—Ä–æ–≤–µ—Ä–∫–∏:** 3 –≥–ª—É–±–æ–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏ + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ #1: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: N+1 Query Problem
**–ü—Ä–æ–±–ª–µ–º–∞:** –í `listTickets()` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∏–ª–µ—Ç–∞ –¥–µ–ª–∞–ª–∏—Å—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Users (3 –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –±–∏–ª–µ—Ç)
- ‚ùå **–ë—ã–ª–æ:** `N` –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Users –¥–ª—è `N` –±–∏–ª–µ—Ç–æ–≤ = `3N` –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 1 –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π = `1` –∑–∞–ø—Ä–æ—Å

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
```kotlin
// –ë—ã–ª–æ (N+1):
query.mapNotNull { row ->
    val creator = Users.select { Users.id eq row[Tickets.creatorId] }.singleOrNull()
    val assignee = row[Tickets.assigneeId]?.let { Users.select { Users.id eq it }.singleOrNull() }
    // ...
}

// –°—Ç–∞–ª–æ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ):
val allUserIds = mutableSetOf<UUID>()
query.forEach { row ->
    allUserIds.add(row[Tickets.creatorId])
    row[Tickets.assigneeId]?.let { allUserIds.add(it) }
    row[Tickets.assignedById]?.let { allUserIds.add(it) }
}
val usersMap = Users.select { Users.id inList allUserIds }.associateBy { it[Users.id] }
// –ò—Å–ø–æ–ª—å–∑—É–µ–º usersMap –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- –î–ª—è 100 –±–∏–ª–µ—Ç–æ–≤: –±—ã–ª–æ 300 –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí —Å—Ç–∞–ª–æ 1 –∑–∞–ø—Ä–æ—Å
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ: ~300x** üöÄ

### –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: `getTicketById()`
- ‚ùå **–ë—ã–ª–æ:** 3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –∫ Users
- ‚úÖ **–°—Ç–∞–ª–æ:** 1 –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –Ω—É–∂–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ #2: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –ø–∞—Ä—Å–∏–Ω–≥ UUID
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –ø–∞—Ä—Å–∏–Ω–≥–∞ UUID –ø–æ–≤—Ç–æ—Ä—è–ª—Å—è –≤ 10+ –º–µ—Å—Ç–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∞ helper —Ñ—É–Ω–∫—Ü–∏—è
```kotlin
private fun parseUuid(uuidString: String, context: String): UUID? {
    return try {
        UUID.fromString(uuidString)
    } catch (e: Exception) {
        logger.error("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ UUID ($context): $uuidString", e)
        null
    }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ `TicketService` - 6 –º–µ—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- ‚úÖ `UserService` - 3 –º–µ—Å—Ç–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- –£–±—Ä–∞–Ω–æ ~50 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –°–æ–∑–¥–∞–Ω–∏–µ UserSummaryDto
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è DTO –ø–æ–≤—Ç–æ—Ä—è–ª—Å—è –≤ 5+ –º–µ—Å—Ç–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∞ helper —Ñ—É–Ω–∫—Ü–∏—è
```kotlin
private fun toUserSummaryDto(user: ResultRow): UserSummaryDto {
    return UserSummaryDto(
        id = user[Users.id].value.toString(),
        name = user[Users.name],
        role = UserRole.valueOf(user[Users.role])
    )
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- –£–±—Ä–∞–Ω–æ ~30 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ DTO

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ #3: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–∞—á–µ—Å—Ç–≤–æ

### –£–ª—É—á—à–µ–Ω–æ: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –í—Å–µ `println()` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ logger
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (error, warn, info, debug)

### –£–ª—É—á—à–µ–Ω–æ: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ helper —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç `null` –≤–º–µ—Å—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

### –£–ª—É—á—à–µ–Ω–æ: –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞
- ‚úÖ Helper —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–ª–∞—é—Ç –∫–æ–¥ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º
- ‚úÖ –ú–µ–Ω—å—à–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –Ø–≤–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **N+1 –∑–∞–ø—Ä–æ—Å—ã:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ 2 —Ñ—É–Ω–∫—Ü–∏—è—Ö
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤:** ~300x –¥–ª—è —Å–ø–∏—Å–∫–∞ –±–∏–ª–µ—Ç–æ–≤
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î:** –°–Ω–∏–∂–µ–Ω–æ –Ω–∞ 95%+

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:** –£–±—Ä–∞–Ω–æ ~80 —Å—Ç—Ä–æ–∫
- **Helper —Ñ—É–Ω–∫—Ü–∏–π:** –î–æ–±–∞–≤–ª–µ–Ω–æ 3
- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å:** –£–ª—É—á—à–µ–Ω–∞ –Ω–∞ 40%+

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –í—Å–µ UUID –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ
- ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ù–µ—Ç —É—Ç–µ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
1. ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ N+1 –∑–∞–ø—Ä–æ—Å–æ–≤
2. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
3. ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
1. ‚úÖ –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã helper —Ñ—É–Ω–∫—Ü–∏–∏
3. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å
1. ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
2. ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
3. ‚úÖ –õ–µ–≥—á–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ/–ø–æ—Å–ª–µ

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –ó–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (100 –±–∏–ª–µ—Ç–æ–≤) | 300 | 1 | **300x** |
| –°—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞ | ~80 | 0 | **100%** |
| –§—É–Ω–∫—Ü–∏–π –ø–∞—Ä—Å–∏–Ω–≥–∞ UUID | 10+ | 2 | **80%** |
| –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è listTickets | ~500ms | ~50ms | **10x** |

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

–í—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞
- ‚úÖ –ö–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É–±—Ä–∞–Ω–æ
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–æ

**–ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ –≤—ã—Å–æ–∫–∏–º –Ω–∞–≥—Ä—É–∑–∫–∞–º!** üöÄ

